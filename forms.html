<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Liste de Sélection avec Bootstrap</title>
    <link rel="stylesheet" href="/Users/valentin/Library/CloudStorage/OneDrive-OGECEnsembleScolaireNiortais/API/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <label for="villeInput">Entrez le nom de la ville :</label>
            <input type="text" class="form-control" id="villeInput" placeholder="Entrez le nom de la ville">
            <button class="btn btn-primary mt-2" id="envoyerButton">Envoyer</button> <!-- Bouton "Envoyer" -->
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Coordonnées</h4>
                    <p class="card-text" id="coordinates"></p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Météo</h4>
                    <p class="card-text" id="weatherDescription"></p>
                    <p class="card-text" id="weatherTemperature"></p>
                    <p class="card-text" id="weatherwindSpeed"></p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="/Users/valentin/Library/CloudStorage/OneDrive-OGECEnsembleScolaireNiortais/API/js/bootstrap.min.js"></script>

<script>
    $('#envoyerButton').on('click', function() { // Gestionnaire pour le bouton "Envoyer"
        var selectedVille = $('#villeInput').val();
        var apiUrl = 'https://api-adresse.data.gouv.fr/search/?q=' + selectedVille;

        $.ajax({
            url: apiUrl,
            method: 'GET',
            success: function(data) {
                var latitude = data.features[0].geometry.coordinates[1];
                var longitude = data.features[0].geometry.coordinates[0];
                $('#coordinates').text('Latitude : ' + latitude + ', Longitude : ' + longitude);
                
                var weatherApiUrl = 'https://api.openweathermap.org/data/2.5/weather?lat=' + latitude + '&lon=' + longitude + '&appid=44db16db91ed95ba40b859d2a01c1d96';
                
                $.ajax({
                    url: weatherApiUrl,
                    method: 'POST',
                    success: function(weatherData) {
                        var temperature = (weatherData.main.temp - 273.15).toFixed(1); // Convertir la température en Celsius
                        var description = weatherData.weather[0].description;
                        var windSpeed = weatherData.wind.speed;

                        $('#weatherDescription').text('Description : ' + description);
                        $('#weatherTemperature').text('Température : ' + temperature +'C°');
                        $('#weatherwindSpeed').text('Vent : ' + windSpeed + 'm/s');


                    },
                    error: function(error) {
                        console.error('Erreur lors de la requête météo :', error);
                    }
                });
            },
            error: function(error) {
                console.error('Erreur lors de la requête :', error);
            }
        });
    });
</script>

</body>
</html>
